<template>
    <div class="main-container">
        <h2 class="slds-m-bottom_small recording-heading">Recording Controls</h2>
        <div class="main-controls slds-grid">
            <div class="control-buttons slds-m-bottom_xx-small slds-grid slds-wrap">
                <button class="only-icon-button slds-col control-btn record-button" title="Start/Resume" data-action="recording" onclick={controlRecording} disabled={controlBtnDisabled.recording}>
                    <svg viewBox="0 0 24 24" ><path d="M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20ZM10.6219 8.41459L15.5008 11.6672C15.6846 11.7897 15.7343 12.0381 15.6117 12.2219C15.5824 12.2658 15.5447 12.3035 15.5008 12.3328L10.6219 15.5854C10.4381 15.708 10.1897 15.6583 10.0672 15.4745C10.0234 15.4088 10 15.3316 10 15.2526V8.74741C10 8.52649 10.1791 8.34741 10.4 8.34741C10.479 8.34741 10.5562 8.37078 10.6219 8.41459Z"></path></svg>
                </button>
                <button class="only-icon-button slds-col control-btn pause-button" title="Pause" data-action="paused" onclick={controlRecording} disabled={controlBtnDisabled.paused}>
                    <svg viewBox="0 0 24 24" ><path d="M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20ZM9 9H11V15H9V9ZM13 9H15V15H13V9Z"></path></svg>
                </button>
                <button class="only-icon-button slds-col control-btn stop-button" title="Finish" data-action="inactive" onclick={controlRecording} disabled={controlBtnDisabled.inactive}>
                    <svg viewBox="0 0 24 24" ><path d="M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20ZM9 9H15V15H9V9Z"></path></svg>
                </button>
                <div if:false={_hideUpload} class="slds-col slds-m-left_xx-small">
                    <label for="fileUploader">
                        <button class="slds-col control-btn upload-button" title="upload audio file" onclick={clickFileInput} disabled={controlBtnDisabled.recording}>
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M15 4H5V20H19V8H15V4ZM3 2.9918C3 2.44405 3.44749 2 3.9985 2H16L20.9997 7L21 20.9925C21 21.5489 20.5551 22 20.0066 22H3.9934C3.44476 22 3 21.5447 3 21.0082V2.9918ZM13 12V16H11V12H8L12 8L16 12H13Z"></path></svg>
                            Upload Audio File...
                        </button>
                    </label>
                    <input style="display:none" type="file" class="slds-col" id="fileUploader" data-name="fileUploader" accept="audio/*" onchange={handleFileUpload} disabled={controlBtnDisabled.disabled}></lightning-file-upload>
                </div>
            </div>
            <div class="slds-grow"></div>
            <!-- Show Only when _hideClip is true -->
            <lightning-button lwc:if={_hideClip} class="only-icon-button slds-m-left_x-small" label="" variant="brand-outline" icon-name="utility:refresh" onclick={refreshRecording} disabled={controlBtnDisabled.disabled}></lightning-button>
        </div>

        <div class="info-message slds-m-top_small">
            <svg viewBox="0 0 24 24" ><path d="M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20ZM9 9H15V15H9V9Z"></path></svg>
            <p lwc:if={infoMessage} class="slds-m-left_x-small slds-grow">{infoMessage} </p>
            <div lwc:if={showVisualize} class="recording-time slds-grid slds-grid_vertical-align-center">
                <svg width="16px" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C17.52 2 22 6.48 22 12C22 17.52 17.52 22 12 22C6.48 22 2 17.52 2 12C2 6.48 6.48 2 12 2ZM12 20C16.42 20 20 16.42 20 12C20 7.58 16.42 4 12 4C7.58 4 4 7.58 4 12C4 16.42 7.58 20 12 20ZM15.5355 7.05025L16.9497 8.46447L12 13.4142L10.5858 12L15.5355 7.05025Z"></path></svg>
                <span class="slds-m-left_x-small">{recodingTime} <template lwc:if={maxAllowTime}> / {maxAllowTime}</template></span>
            </div>
        </div>
        
        <div class="slds-grid slds-grid_vertical-align-center slds-wrap">
            <!-- <p data-id={clip.id} class="slds-m-right_x-small">{clip.name}:</p> -->
            <div lwc:if={showClip} class="slds-grid slds-wrap slds-m-top_small recording-controller">
                <div class="output-audio slds-grid slds-grid_vertical-align-center">
                    <audio controls preload="metadata">
                        <source src={clip.url} type="audio/mpeg">
                    </audio>
                    <div lwc:if={clipSize} class="file-size slds-grid slds-grid_vertical-align-center slds-grid_align-center">
                        <svg class="slds-m-right_xx-small" viewBox="0 0 24 24" width="18px" fill="currentColor" title="File Size" lwc-3h6ht58pst0=""><path d="M5 12.5C5 12.8134 5.46101 13.3584 6.53047 13.8931C7.91405 14.5849 9.87677 15 12 15C14.1232 15 16.0859 14.5849 17.4695 13.8931C18.539 13.3584 19 12.8134 19 12.5V10.3287C17.35 11.3482 14.8273 12 12 12C9.17273 12 6.64996 11.3482 5 10.3287V12.5ZM19 15.3287C17.35 16.3482 14.8273 17 12 17C9.17273 17 6.64996 16.3482 5 15.3287V17.5C5 17.8134 5.46101 18.3584 6.53047 18.8931C7.91405 19.5849 9.87677 20 12 20C14.1232 20 16.0859 19.5849 17.4695 18.8931C18.539 18.3584 19 17.8134 19 17.5V15.3287ZM3 17.5V7.5C3 5.01472 7.02944 3 12 3C16.9706 3 21 5.01472 21 7.5V17.5C21 19.9853 16.9706 22 12 22C7.02944 22 3 19.9853 3 17.5ZM12 10C14.1232 10 16.0859 9.58492 17.4695 8.89313C18.539 8.3584 19 7.81342 19 7.5C19 7.18658 18.539 6.6416 17.4695 6.10687C16.0859 5.41508 14.1232 5 12 5C9.87677 5 7.91405 5.41508 6.53047 6.10687C5.46101 6.6416 5 7.18658 5 7.5C5 7.81342 5.46101 8.3584 6.53047 8.89313C7.91405 9.58492 9.87677 10 12 10Z" lwc-3h6ht58pst0=""></path></svg>
                        {clipSize.MB} MB
                    </div>
                </div>
                <button class="only-icon-button slds-m-left_x-small control-btn refresh-button" title="discard" onclick={refreshRecording} disabled={controlBtnDisabled.disabled}>
                     <svg viewBox="0 0 24 24" ><path d="M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20ZM12 10.5858L14.8284 7.75736L16.2426 9.17157L13.4142 12L16.2426 14.8284L14.8284 16.2426L12 13.4142L9.17157 16.2426L7.75736 14.8284L10.5858 12L7.75736 9.17157L9.17157 7.75736L12 10.5858Z"></path></svg>
                </button>
                <button if:false={_hideSave} class="only-icon-button slds-m-left_x-small control-btn save-button" title="save" onclick={saveClip} disabled={controlBtnDisabled.disabled}>
                    <svg viewBox="0 0 24 24"><path d="M5 5V19H19V7.82843L16.1716 5H5ZM4 3H17L20.7071 6.70711C20.8946 6.89464 21 7.149 21 7.41421V20C21 20.5523 20.5523 21 20 21H4C3.44772 21 3 20.5523 3 20V4C3 3.44772 3.44772 3 4 3ZM12 18C10.3431 18 9 16.6569 9 15C9 13.3431 10.3431 12 12 12C13.6569 12 15 13.3431 15 15C15 16.6569 13.6569 18 12 18ZM6 6H15V10H6V6Z"></path></svg>
                </button>
            </div>
            <canvas if:false={_hideVisualizer} data-display={showVisualize} class="visualizer slds-m-vertical_x-small"></canvas>
        </div>
    </div>
</template>