<template>
    <section role="dialog" tabindex="-1" class="main-section">
        <div class="main-div">
            <div class="content-body">
                <div class="outer-grid">
                    
                    <div class="inner-grid-1 left-panel">
                        <div class="form-scroll-container">
                            
                            <div class="form-group">
                                <lightning-combobox
                                    name="template"
                                    label="Select Email Template"
                                    value={selectedTemplateId}
                                    placeholder="Select Template..."
                                    options={templateOptions}
                                    onchange={handleTemplateChange}
                                    required>
                                </lightning-combobox>
                            </div>

                            <div class="form-group">
                                <lightning-combobox
                                    name="fromAddress"
                                    label="From Address (Org-Wide Email)"
                                    value={selectedFromAddress}
                                    placeholder="Select From Address..."
                                    options={fromOptions}
                                    onchange={handleFromChange}
                                    required>
                                </lightning-combobox>
                            </div>

                            <div class="form-group">
                                <lightning-record-picker
                                    label="To"
                                    placeholder="Search Contact..."
                                    object-api-name="Contact"
                                    value={selectedToId}
                                    onchange={handleToChange}
                                    required>
                                </lightning-record-picker>
                            </div>

                            <div class="form-group">
                                <lightning-record-picker
                                    label="CC"
                                    placeholder="Search Contact..."
                                    object-api-name="Contact"
                                    value={selectedCcId}
                                    onchange={handleCcChange}>
                                </lightning-record-picker>
                                <div class="checkbox-wrapper mt-1">
                                    <lightning-input type="checkbox" label="CC Current User" checked={ccCurrentUser} onchange={handleCcUserChange}></lightning-input>
                                </div>
                            </div>

                            <div class="form-group">
                                <lightning-record-picker
                                    label="BCC"
                                    placeholder="Search Contact..."
                                    object-api-name="Contact"
                                    value={selectedBccId}
                                    onchange={handleBccChange}>
                                </lightning-record-picker>
                            </div>

                            <div class="form-group">
                                <lightning-input 
                                    label="Subject" 
                                    value={subject} 
                                    onchange={handleSubjectChange} 
                                    required>
                                </lightning-input>
                            </div>

                            <div class="form-group">
                                <lightning-input-rich-text
                                    label="Body"
                                    value={emailBody}
                                    onchange={handleBodyChange}
                                    required
                                    variant="bottom-toolbar">
                                </lightning-input-rich-text>
                            </div>

                            <div class="form-group checkbox-wrapper mt-2">
                                <lightning-input type="checkbox" label="Use Your Custom Email Signature"></lightning-input>
                            </div>

                            <div class="form-group mt-3">
                                <label class="slds-form-element__label">Attachments</label>
                                <div class="attachment-box">
                                    <button class="upload-btn"><lightning-icon icon-name="utility:upload" size="x-small" class="mr-1"></lightning-icon> Upload Files</button>
                                    <span class="drag-text">Or drop files</span>
                                    <button class="select-btn">Select File From Record</button>
                                </div>
                            </div>
                            
                            <div class="form-group mt-3">
                                <label class="slds-form-element__label">Signature</label>
                                <div class="signature-pad"></div>
                                <div class="sig-footer">
                                    <button class="clear-sig-btn">Clear Signature</button>
                                </div>
                            </div>

                        </div>
                    </div>

                    <div class="inner-grid-2 right-panel">
                        <div class="preview-scroll-container">
                            
                            <div class="accordion-item">
                                <div class="accordion-header" onclick={toggleBodyPreview}>
                                    <span>Email Body Preview</span>
                                    <lightning-icon icon-name={bodyPreviewIcon} size="x-small"></lightning-icon>
                                </div>
                                <div class={bodyPreviewClass}>
                                    <div class="preview-content">
                                        <lightning-formatted-rich-text value={emailBody}></lightning-formatted-rich-text>
                                        <div if:false={emailBody} class="slds-text-color_weak slds-text-align_center">
                                            Body is empty...
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="accordion-item mt-2">
                                <div class="accordion-header" onclick={toggleAttachmentPreview}>
                                    <span>Selected Template Preview</span>
                                    <lightning-icon icon-name={attachmentPreviewIcon} size="x-small"></lightning-icon>
                                </div>
                                <div class={attachmentPreviewClass}>
                                    <div class="preview-content">
                                        
                                        <div class="preview-subject" if:true={subject}>
                                            <div class="slds-text-title_bold slds-m-bottom_xx-small">Subject:</div>
                                            <div class="slds-m-bottom_small">{subject}</div>
                                            <hr style="margin: 5px 0; border: 0; border-top: 1px solid #ddd;"/>
                                        </div>

                                        <lightning-formatted-rich-text value={emailBody}></lightning-formatted-rich-text>
                                        
                                        <div if:false={emailBody} class="slds-text-color_weak slds-text-align_center slds-p-around_medium">
                                            Select a template to view preview.
                                        </div>

                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

            <div class="popUpFooter">
                <button class="footer-btn secondary" onclick={handleClose}>Accept and Close</button>
                <button class="footer-btn secondary" onclick={handleSendEmail}>Accept and Send Email</button>
                <button class="footer-btn secondary" onclick={handleSendEmail}>Send Email</button>
                <button class="footer-btn primary-outline" onclick={handleClose}>Cancel</button>
            </div>
        </div>
    </section>
</template>