<template>

    <div class="spinner-container slds-is-fixed" if:true={isLoading}>
        <lightning-spinner alternative-text="Loading..." size="medium"></lightning-spinner>
    </div>

    <div class="header-info slds-m-bottom_medium">
        <h1 class="title slds-grid slds-grid_vertical-align-center">
            <svg viewBox="0 0 24 24" class="slds-m-right_x-small"><path d="M16.9337 8.96494C16.426 5.03562 13.0675 2 9 2 4.58172 2 1 5.58172 1 10 1 11.8924 1.65707 13.6313 2.7555 15.0011 3.56351 16.0087 4.00033 17.1252 4.00025 18.3061L4 22H13L13.001 19H15C16.1046 19 17 18.1046 17 17V14.071L18.9593 13.2317C19.3025 13.0847 19.3324 12.7367 19.1842 12.5037L16.9337 8.96494ZM3 10C3 6.68629 5.68629 4 9 4 12.0243 4 14.5665 6.25141 14.9501 9.22118L15.0072 9.66262 16.5497 12.0881 15 12.7519V17H11.0017L11.0007 20H6.00013L6.00025 18.3063C6.00036 16.6672 5.40965 15.114 4.31578 13.7499 3.46818 12.6929 3 11.3849 3 10ZM21.1535 18.1024 19.4893 16.9929C20.4436 15.5642 21 13.8471 21 12.0001 21 10.153 20.4436 8.4359 19.4893 7.00722L21.1535 5.89771C22.32 7.64386 23 9.74254 23 12.0001 23 14.2576 22.32 16.3562 21.1535 18.1024Z"></path></svg>
            <!-- <svg viewBox="0 0 24 24" class="slds-m-right_x-small"><path d="M14.5 5H6C4.89543 5 4 5.89543 4 7V17C4 18.1046 4.89543 19 6 19H18C19.1046 19 20 18.1046 20 17V14.5H22V17C22 19.2091 20.2091 21 18 21H6C3.79086 21 2 19.2091 2 17V7C2 4.79086 3.79086 3 6 3H14.5V5ZM14 11H11V17H9V11H6V9H14V11ZM20.6572 1.34277C22.1049 2.79049 23 4.79086 23 7C23 9.20914 22.1049 11.2095 20.6572 12.6572L19.2422 11.2422C20.328 10.1564 21 8.65685 21 7C21 5.34315 20.328 3.8436 19.2422 2.75781L20.6572 1.34277ZM17.8281 4.17188C18.552 4.89573 19 5.89543 19 7C19 8.10457 18.552 9.10427 17.8281 9.82812L16.4141 8.41406C16.776 8.05213 17 7.55228 17 7C17 6.44772 16.776 5.94787 16.4141 5.58594L17.8281 4.17188Z"></path></svg> -->
            Shift Log Activity Recorder
        </h1>
        <p class="sub-info">Record shift activity anytime during the day using your voice command. </br>Work Performed, Plan for Tomorrow, Exceptions, or Notes to Office.</p>
        <!-- <p class="sub-info">You can record shift activity multiple times in a day upto 10MB of total recording size.</p> -->
    </div>

    <div lwc:if={limitExceeded} class="slds-text-color_error slds-m-vertical_xx-small">Your Today's Shift Logs Recoding Limit Exceeded. You can't capture more shift log via recoding!</div>
    <c-cmp_audio-recorder class="recording-section slds-m-vertical_large" onsave={handleSaveRecoding} disabled={limitExceeded}></c-cmp_audio-recorder>

    <div class="clip-list-section">
        <h2 class="log-list-title slds-m-top_small slds-m-bottom_x-small slds-grid slds-grid_vertical-align-center">
            <svg viewBox="0 0 24 24" class="slds-m-right_x-small"><path d="M20 22H4C3.44772 22 3 21.5523 3 21V3C3 2.44772 3.44772 2 4 2H20C20.5523 2 21 2.44772 21 3V21C21 21.5523 20.5523 22 20 22ZM19 20V4H5V20H19ZM8 7H16V9H8V7ZM8 11H16V13H8V11ZM8 15H13V17H8V15Z"></path></svg>
            Today's Shift Logs
        </h2>
        <p class="slds-m-bottom_x-small slds-text-title_caps slds-text-color_weak">Total Recoding Size: {clipSizeLimits.MB}/10 MB</p>
        <template lwc:if={clips.length} for:each={clips} for:item="clip" for:index="index">
            <div key={clip.id}>
                <div class="single-clip slds-m-bottom_x-small">
                    <div class="clip-info slds-m-bottom_x-small">
                        <div class="slds-grid slds-grid_vertical-align-center slds-m-bottom_x-small" title="Created By">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M20 22H4V20C4 17.2386 6.23858 15 9 15H15C17.7614 15 20 17.2386 20 20V22ZM12 13C8.68629 13 6 10.3137 6 7C6 3.68629 8.68629 1 12 1C15.3137 1 18 3.68629 18 7C18 10.3137 15.3137 13 12 13Z"></path></svg>
                            <p class="slds-text-title_caps">{clip.createdByName}</p>
                        </div>
                        <div class="slds-grid slds-grid_vertical-align-center">
                            <div class="slds-grid slds-grid_vertical-align-center">
                                <svg viewBox="0 0 24 24" fill="currentColor" title="Created Date"><path d="M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20ZM13 12H17V14H11V7H13V12Z"></path></svg>
                                <lightning-formatted-date-time class="slds-m-left_xx-small slds-text-color_weak" value={clip.CreatedDate} year="numeric" month="numeric" day="numeric"
                                             hour="2-digit" minute="2-digit" >
                                </lightning-formatted-date-time>
                            </div>
                            <div class="slds-grid slds-grid_vertical-align-center slds-m-left_x-small">
                                <svg viewBox="0 0 24 24" class="slds-m-right_xx-small" title="File Size"><path d="M5 12.5C5 12.8134 5.46101 13.3584 6.53047 13.8931C7.91405 14.5849 9.87677 15 12 15C14.1232 15 16.0859 14.5849 17.4695 13.8931C18.539 13.3584 19 12.8134 19 12.5V10.3287C17.35 11.3482 14.8273 12 12 12C9.17273 12 6.64996 11.3482 5 10.3287V12.5ZM19 15.3287C17.35 16.3482 14.8273 17 12 17C9.17273 17 6.64996 16.3482 5 15.3287V17.5C5 17.8134 5.46101 18.3584 6.53047 18.8931C7.91405 19.5849 9.87677 20 12 20C14.1232 20 16.0859 19.5849 17.4695 18.8931C18.539 18.3584 19 17.8134 19 17.5V15.3287ZM3 17.5V7.5C3 5.01472 7.02944 3 12 3C16.9706 3 21 5.01472 21 7.5V17.5C21 19.9853 16.9706 22 12 22C7.02944 22 3 19.9853 3 17.5ZM12 10C14.1232 10 16.0859 9.58492 17.4695 8.89313C18.539 8.3584 19 7.81342 19 7.5C19 7.18658 18.539 6.6416 17.4695 6.10687C16.0859 5.41508 14.1232 5 12 5C9.87677 5 7.91405 5.41508 6.53047 6.10687C5.46101 6.6416 5 7.18658 5 7.5C5 7.81342 5.46101 8.3584 6.53047 8.89313C7.91405 9.58492 9.87677 10 12 10Z"></path></svg>
                                <p class="slds-text-title_caps slds-text-color_weak">{clip.size_mb} MB</p>
                            </div>
                        </div>
                    </div>
                    <div class="slds-grid slds-gutters_x-small">
                        <audio class="output-audio" controls src={clip.VersionDataUrl}></audio>
                        <button class="control-btn delete-btn slds-m-left_small" data-index={index} data-id={clip.Id} onclick={handleDeleteClip} disabled={clip.notMyClip} title="Delete Recording">
                            <svg viewBox="0 0 24 24"><path d="M17 6H22V8H20V21C20 21.5523 19.5523 22 19 22H5C4.44772 22 4 21.5523 4 21V8H2V6H7V3C7 2.44772 7.44772 2 8 2H16C16.5523 2 17 2.44772 17 3V6ZM18 8H6V20H18V8ZM9 4V6H15V4H9Z"></path></svg>
                        </button>
                    </div>
                </div>
            </div>
        </template>
        <template lwc:else>
            <div class="empty-state slds-m-vertical_small">
                <p class="title">No shift logs recorded yet.</p>
                <p class="sub-info">Start by adding your first shift log entry using the Record Shift Log button.</p>
            </div>
        </template>
    </div>
</template>