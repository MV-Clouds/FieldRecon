<template>
    <lightning-card>
        <template if:true={isLoading}>
            <lightning-spinner alternative-text="Loading" size="medium"></lightning-spinner>
        </template>

         <!-- Show message if not eligible -->
        <template if:false={isBidValid}>
            <div class="slds-p-around_large slds-text-align_center">
                <lightning-icon icon-name="utility:error" size="large" class="slds-m-bottom_small" style="color: #c23934;"></lightning-icon>
                <h2 class="slds-text-heading_medium slds-m-bottom_small">Cannot Create Proposal</h2>
                <p class="slds-text-body_regular">
                    Only Bids with status "Bidding" are allowed to create proposals.
                </p>
            </div>
        </template>

        <template if:true={isBidValid}>
            <div class="slds-p-around_medium component-wrapper">
                        <lightning-record-edit-form
                            object-api-name="wfrecon__Proposal__c"
                            onsuccess={handleSuccess}
                            onerror={handleError}
                            onload={handleLoad}
                            density="comfy">
                            
                            <div class="slds-grid slds-wrap slds-gutters modal-scrollable">
                                <!-- Bid Field - Full Width -->
                            
                                <div class="slds-col slds-size_1-of-2 slds-m-bottom_small">
                                    <lightning-input-field
                                        field-name="wfrecon__Bid__c"
                                        value={bidId}
                                        required
                                        disabled>
                                    </lightning-input-field>
                                </div>
                                <div class="slds-col slds-size_1-of-2 slds-m-bottom_small">
                                    <lightning-input-field
                                        field-name="wfrecon__Type__c"
                                        required>
                                    </lightning-input-field>
                                </div>

                                <!-- Account & Contact - Side by Side -->
                                <div class="slds-col slds-size_1-of-2 slds-m-bottom_small">
                                    <lightning-input-field
                                        field-name="wfrecon__Account__c"
                                        value={accountId}
                                        required>
                                    </lightning-input-field>
                                </div>
                                <div class="slds-col slds-size_1-of-2 slds-m-bottom_small">
                                    <lightning-input-field
                                        field-name="wfrecon__Contact__c"
                                        value={contactId}
                                        required
                                        onchange={handleContactChange}>
                                    </lightning-input-field>
                                </div>

                                <!-- Contact Email & Phone - Side by Side -->
                                <div class="slds-col slds-size_1-of-2 slds-m-bottom_small">
                                    <lightning-input
                                        label="Sales Person Email"
                                        value={contactEmail}
                                        type="email"
                                        disabled
                                        variant="label-stacked">
                                    </lightning-input>
                                </div>
                                <div class="slds-col slds-size_1-of-2 slds-m-bottom_small">
                                    <lightning-input
                                        label="Sales Person Phone"
                                        value={contactPhone}
                                        type="tel"
                                        disabled
                                        variant="label-stacked">
                                    </lightning-input>
                                </div>

                                <!-- Status & OH - Side by Side -->
                                <div class="slds-col slds-size_1-of-2 slds-m-bottom_small">
                                    <lightning-input-field
                                        field-name="wfrecon__Status__c"
                                        required>
                                    </lightning-input-field>
                                </div>
                                <div class="slds-col slds-size_1-of-2 slds-m-bottom_small">
                                    <lightning-input
                                        label="OH"
                                        name="wfrecon__OH__c"
                                        value={ohDisplay}
                                        type="text"
                                        disabled="true"
                                        variant="label-stacked"
                                        onchange={handlePercentageInput}
                                        onblur={handlePercentageBlur}>
                                    </lightning-input>
                                </div>

                                <!-- Warranty & Profit - Side by Side -->
                                <div class="slds-col slds-size_1-of-2 slds-m-bottom_small">
                                    <lightning-input
                                        label="Warranty"
                                        name="wfrecon__Warranty__c"
                                        value={warrantyDisplay}
                                        disabled="true"
                                        type="text"
                                        variant="label-stacked"
                                        onchange={handlePercentageInput}
                                        onblur={handlePercentageBlur}>
                                    </lightning-input>
                                </div>
                                <div class="slds-col slds-size_1-of-2 slds-m-bottom_small">
                                    <lightning-input
                                        label="Profit"
                                        name="wfrecon__Profit__c"
                                        value={profitDisplay}
                                        type="text"
                                        variant="label-stacked"
                                        onchange={handlePercentageInput}
                                        onblur={handlePercentageBlur}>
                                    </lightning-input>
                                </div>

                                <!-- Expiration Date - Full Width -->
                                <div class="slds-col slds-size_1-of-1 slds-m-bottom_small">
                                    <lightning-input
                                        label="Expiration Date"
                                        type="date"
                                        value={expirationDate}
                                        variant="label-stacked"
                                        onchange={handleExpirationDateChange}>
                                    </lightning-input>
                                </div>

                                <!-- Hidden fields to store actual percentage values -->
                                <div style="display: none;">
                                    <lightning-input-field class="hidden-percentage-field" field-name="wfrecon__OH__c" value={ohValue}></lightning-input-field>
                                    <lightning-input-field class="hidden-percentage-field" field-name="wfrecon__Warranty__c" value={warrantyValue}></lightning-input-field>
                                    <lightning-input-field class="hidden-percentage-field" field-name="wfrecon__Profit__c" value={profitValue}></lightning-input-field>
                                    <lightning-input-field field-name="wfrecon__Expiration_Date__c" value={expirationDate}></lightning-input-field>
                                </div>

                            </div>

                            <div class="footer-div">
                                <button 
                                    class="save-btn"
                                    onclick={handleSave}>Save
                                </button>
                            </div>


                        </lightning-record-edit-form>
             </div>
        </template>
       
    </lightning-card>
</template>