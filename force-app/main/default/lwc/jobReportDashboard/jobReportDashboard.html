<template>
    <template if:true={isLoading}>
        <div class="spinner-container">
            <lightning-spinner alternative-text="Loading..." size="medium"></lightning-spinner>
        </div>
    </template>
    <!-- Access Denied -->
    <template if:false={hasAccess}>
        <div class="wrapper">
            <div class="no-prop">
                <div class="empty-space">
                    <div class="empty-space__content">
                        <div class="empty__icon">
                            <img src="/resource/wfrecon__emptyState" alt="Access Denied" />
                        </div>
                        <div class="empty-space__message">Access Denied</div>
                        <div class="empty-space__subtitle">{accessErrorMessage}</div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <template if:true={hasAccess}>
        <div class="main-div">
            <div class="main-card">
                <!-- Status Metrics Section -->
                <div class="metrics-container">
                    <div class="metrics-header">
                        <h2 class="metrics-title">WIP Report and Dashboard</h2>
                        <!-- Add Refresh Button -->
                        <button class="refresh-btn" onclick={handleRefresh} title="Refresh All Data">
                            Refresh
                        </button>
                    </div>

                    <div class="metrics-cards-container">
                        <!-- Backlog Metric -->
                        <div class="metric-card backlog-metric" data-label="backlog" onclick={handleMetricClick}>
                            <div class="metric-content">
                                <div class="metric-head">
                                    <div class="metric-title">Backlog</div>

                                    <div class="action-btns">
                                        <div class="edit-btn btn action-btn" data-metric="backlog"
                                            onclick={openEditPopup}>
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640">
                                                <path
                                                    d="M416.9 85.2L372 130.1L509.9 268L554.8 223.1C568.4 209.6 576 191.2 576 172C576 152.8 568.4 134.4 554.8 120.9L519.1 85.2C505.6 71.6 487.2 64 468 64C448.8 64 430.4 71.6 416.9 85.2zM338.1 164L122.9 379.1C112.2 389.8 104.4 403.2 100.3 417.8L64.9 545.6C62.6 553.9 64.9 562.9 71.1 569C77.3 575.1 86.2 577.5 94.5 575.2L222.3 539.7C236.9 535.6 250.2 527.9 261 517.1L476 301.9L338.1 164z" />
                                            </svg>
                                        </div>
                                    </div>

                                </div>
                                <div class="metric-count">
                                    <lightning-formatted-number value={backlogValue} format-style="currency"
                                        currency-code="USD" maximum-fraction-digits="2">
                                    </lightning-formatted-number>
                                </div>
                                <div class="metric-value">Number of Jobs: {backlogCount}</div>
                            </div>
                            <div class="metric-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M9 5H7C5.89543 5 5 5.89543 5 7V19C5 20.1046 5.89543 21 7 21H17C18.1046 21 19 20.1046 19 19V7C19 5.89543 18.1046 5 17 5H15"
                                        stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" />
                                    <path d="M12 12H15" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" />
                                    <path d="M12 16H15" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" />
                                    <path d="M9 9H9.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" />
                                    <path d="M9 12H9.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" />
                                    <path d="M9 16H9.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" />
                                    <path d="M9 5C9 3.89543 9.89543 3 11 3H13C14.1046 3 15 3.89543 15 5V7H9V5Z"
                                        stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" />
                                </svg>
                            </div>
                        </div>

                        <!-- In Progress Metric -->
                        <div class="metric-card inprogress-metric" data-label="inProgress" onclick={handleMetricClick}>
                            <div class="metric-content">
                                <div class="metric-head">
                                    <div class="metric-title">In Progress</div>

                                    <div class="action-btns">
                                        <div class="edit-btn btn action-btn" data-metric="inProgress"
                                            onclick={openEditPopup}>
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640">
                                                <path
                                                    d="M416.9 85.2L372 130.1L509.9 268L554.8 223.1C568.4 209.6 576 191.2 576 172C576 152.8 568.4 134.4 554.8 120.9L519.1 85.2C505.6 71.6 487.2 64 468 64C448.8 64 430.4 71.6 416.9 85.2zM338.1 164L122.9 379.1C112.2 389.8 104.4 403.2 100.3 417.8L64.9 545.6C62.6 553.9 64.9 562.9 71.1 569C77.3 575.1 86.2 577.5 94.5 575.2L222.3 539.7C236.9 535.6 250.2 527.9 261 517.1L476 301.9L338.1 164z" />
                                            </svg>
                                        </div>
                                    </div>

                                </div>
                                <div class="metric-count">
                                    <lightning-formatted-number value={inProgressValue} format-style="currency"
                                        currency-code="USD" maximum-fraction-digits="2">
                                    </lightning-formatted-number>
                                </div>
                                <div class="metric-value">Number of Jobs: {inProgressCount}</div>

                            </div>
                            <div class="metric-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z"
                                        stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" />
                                    <path d="M12 6V12L16 14" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                            </div>
                        </div>

                        <!-- Work Remaining Metric -->
                        <div class="metric-card close-metric" data-label="workRemaining" onclick={handleMetricClick}>
                            <div class="metric-content">
                                <div class="metric-head">
                                    <div class="metric-title">Work Remaining</div>

                                    <div class="action-btns">
                                        <div class="edit-btn btn action-btn" data-metric="workRemaining"
                                            onclick={openEditPopup}>
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640">
                                                <path
                                                    d="M416.9 85.2L372 130.1L509.9 268L554.8 223.1C568.4 209.6 576 191.2 576 172C576 152.8 568.4 134.4 554.8 120.9L519.1 85.2C505.6 71.6 487.2 64 468 64C448.8 64 430.4 71.6 416.9 85.2zM338.1 164L122.9 379.1C112.2 389.8 104.4 403.2 100.3 417.8L64.9 545.6C62.6 553.9 64.9 562.9 71.1 569C77.3 575.1 86.2 577.5 94.5 575.2L222.3 539.7C236.9 535.6 250.2 527.9 261 517.1L476 301.9L338.1 164z" />
                                            </svg>
                                        </div>
                                    </div>

                                </div>
                                <div class="metric-count">
                                    <lightning-formatted-number value={remainingValue} format-style="currency"
                                        currency-code="USD" maximum-fraction-digits="2">
                                    </lightning-formatted-number>
                                </div>
                                <div class="metric-value">Number of Jobs: {remainingCount}</div>
                            </div>
                            <div class="metric-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path d="M9 12L11 14L15 10" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round" />
                                    <path
                                        d="M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z"
                                        stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" />
                                </svg>
                            </div>
                        </div>

                        <!-- Open Balance Metric -->
                        <div class="metric-card outstanding-metric" data-label="openBalance"
                            onclick={handleMetricClick}>
                            <div class="metric-content">
                                <div class="metric-head">
                                    <div class="metric-title">Open Balance</div>

                                    <div class="action-btns">
                                        <div class="edit-btn btn action-btn" data-metric="openBalance"
                                            onclick={openEditPopup}>
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640">
                                                <path
                                                    d="M416.9 85.2L372 130.1L509.9 268L554.8 223.1C568.4 209.6 576 191.2 576 172C576 152.8 568.4 134.4 554.8 120.9L519.1 85.2C505.6 71.6 487.2 64 468 64C448.8 64 430.4 71.6 416.9 85.2zM338.1 164L122.9 379.1C112.2 389.8 104.4 403.2 100.3 417.8L64.9 545.6C62.6 553.9 64.9 562.9 71.1 569C77.3 575.1 86.2 577.5 94.5 575.2L222.3 539.7C236.9 535.6 250.2 527.9 261 517.1L476 301.9L338.1 164z" />
                                            </svg>
                                        </div>
                                    </div>

                                </div>
                                <div class="metric-count">
                                    <lightning-formatted-number value={openBalanceValue} format-style="currency"
                                        currency-code="USD" maximum-fraction-digits="2">
                                    </lightning-formatted-number>
                                </div>
                                <div class="metric-value">Number of Jobs: {openBalanceCount}</div>

                            </div>
                            <div class="metric-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path d="M9 12L11 14L15 10" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round" />
                                    <path
                                        d="M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C13.9 3 15.64 3.57 17.05 4.55"
                                        stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" />
                                </svg>
                            </div>
                        </div>

                        <!-- Retainage Pending Metric -->
                        <div class="metric-card retainage-metric" data-label="retainagePending"
                            onclick={handleMetricClick}>
                            <div class="metric-content">
                                <div class="metric-head">
                                    <div class="metric-title">Retainage Pending</div>

                                    <div class="action-btns">
                                        <div class="edit-btn btn action-btn" data-metric="retainagePending"
                                            onclick={openEditPopup}>
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640">
                                                <path
                                                    d="M416.9 85.2L372 130.1L509.9 268L554.8 223.1C568.4 209.6 576 191.2 576 172C576 152.8 568.4 134.4 554.8 120.9L519.1 85.2C505.6 71.6 487.2 64 468 64C448.8 64 430.4 71.6 416.9 85.2zM338.1 164L122.9 379.1C112.2 389.8 104.4 403.2 100.3 417.8L64.9 545.6C62.6 553.9 64.9 562.9 71.1 569C77.3 575.1 86.2 577.5 94.5 575.2L222.3 539.7C236.9 535.6 250.2 527.9 261 517.1L476 301.9L338.1 164z" />
                                            </svg>
                                        </div>
                                    </div>

                                </div>
                                <div class="metric-count">
                                    <lightning-formatted-number value={retainageValue} format-style="currency"
                                        currency-code="USD" maximum-fraction-digits="2">
                                    </lightning-formatted-number>
                                </div>
                                <div class="metric-value">Number of Jobs: {retainageCount}</div>
                            </div>
                            <div class="metric-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 1V23" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" />
                                    <path
                                        d="M17 5H9.5C8.57174 5 7.6815 5.36875 7.02513 6.02513C6.36875 6.6815 6 7.57174 6 8.5C6 9.42826 6.36875 10.3185 7.02513 10.9749C7.6815 11.6313 8.57174 12 9.5 12H14.5C15.4283 12 16.3185 12.3687 16.9749 13.0251C17.6313 13.6815 18 14.5717 18 15.5C18 16.4283 17.6313 17.3185 16.9749 17.9749C16.3185 18.6313 15.4283 19 14.5 19H6"
                                        stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" />
                                </svg>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <!-- Two-Column Layout -->
            <div class="two-column-container">
                <!-- Finance Tab -->
                <div class="table-section">
                    <div class="table-header-section">
                        <h3 class="table-title">Finance Overview</h3>
                        <div class="table-actions">
                            <div class="view-toggle">
                                <button class={tableButtonClass} onclick={switchToTableView} title="Table View">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d="M15 9H21M15 9V20M15 9H9M21 9V18C21 18.943 21 19.414 20.707 19.707C20.414 20 19.943 20 19 20H15M21 9V6C21 5.057 21 4.586 20.707 4.293C20.414 4 19.943 4 19 4H5C4.057 4 3.586 4 3.293 4.293C3 4.586 3 5.057 3 6V9M21 9H3M15 20H9M3 9H9M3 9V18C3 18.943 3 19.414 3.293 19.707C3.586 20 4.057 20 5 20H9M9 9V20"
                                            stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                                    </svg>
                                </button>
                                <button class={chartButtonClass} onclick={switchToChartView} title="Chart View">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round"
                                        class="icon icon-tabler icons-tabler-outline icon-tabler-chart-bar">
                                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                        <path
                                            d="M3 13a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v6a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z" />
                                        <path
                                            d="M15 9a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v10a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z" />
                                        <path
                                            d="M9 5a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v14a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z" />
                                        <path d="M4 20h14" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="filters-contain">
                        <div class="filters-container">
                            <div class="filter-group">
                                <lightning-input type="search" placeholder="Search by job name..."
                                    variant="label-hidden" value={searchTerm} onchange={handleSearchInput}
                                    onkeypress={handleKeyPress} class="search-box">
                                </lightning-input>

                            </div>
                            <div class="filter-group">
                                <div class="custom-multiselect">
                                    <div class="multiselect-header" onclick={toggleStatusDropdown}>
                                        <span class="selected-text">{selectedStatusText}</span>
                                        <lightning-icon icon-name="utility:down" size="x-small"></lightning-icon>
                                    </div>
                                    <template if:true={showStatusDropdown}>
                                        <div class="multiselect-dropdown">
                                            <div class="dropdown-search">
                                                <lightning-input type="search" placeholder="Search..."
                                                    variant="label-hidden" value={statusSearchTerm}
                                                    onchange={handleStatusSearch} onclick={handleDropdownClick}>
                                                </lightning-input>
                                            </div>
                                            <div class="dropdown-options">
                                                <template if:true={filteredStatusOptions.length}>
                                                    <template for:each={filteredStatusOptions} for:item="option">
                                                        <div key={option.value} class="option-item"
                                                            onclick={handleStatusToggle} data-value={option.value}>
                                                            <lightning-input type="checkbox" label={option.label}
                                                                checked={option.selected} data-value={option.value}
                                                                onclick={handleStatusToggle}>
                                                            </lightning-input>
                                                        </div>
                                                    </template>
                                                </template>
                                                <template if:false={filteredStatusOptions.length}>
                                                    <div class="no-options-found">
                                                        No options found
                                                    </div>
                                                </template>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>

                            <div class="filter-group">
                                <button class="clear-filters-btn" onclick={clearFilters}>
                                    Reset Filters
                                </button>
                            </div>
                        </div>

                        <!-- Recently Viewed Button -->
                        <div class="filter-group">
                            <button class="recently-viewed-btn" onclick={toggleRecentlyViewed}
                                title="Show recently viewed jobs">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path d="M9 12L11 14L15 10" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round" />
                                    <path
                                        d="M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C13.9 3 15.64 3.57 17.05 4.55"
                                        stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" />
                                </svg>
                                {recentlyViewedButtonLabel}
                            </button>
                        </div>
                    </div>


                    <div class="data-table-container">
                        <template if:true={showChart}>
                            <!-- Chart Container -->
                            <template if:true={isFinanceDataAvailable}>
                                <div class="chart-container" lwc:dom="manual"></div>
                            </template>
                            <template if:false={isFinanceDataAvailable}>
                                <div class="no-records-message">
                                    <div class="empty-state">
                                        <div class="empty-state__content">
                                            <div class="empty-state__icon">
                                                <img src="/resource/wfrecon__emptyState" alt="" draggable="false">
                                            </div>
                                            <div class="empty-state__message">No data available to show</div>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </template>

                        <template if:false={showChart}>
                            <template if:true={isFinanceDataAvailable}>
                                <table class="custom-data-table">
                                    <thead class="table-header">
                                        <tr>
                                            <th class="header-cell">Sr No.</th>
                                            <th class="header-cell">Job Number</th>
                                            <th class="header-cell">Job Name</th>
                                            <th class="header-cell">Total Contract</th>
                                            <th class="header-cell">Base Contract</th>
                                            <th class="header-cell">Change Order</th>
                                            <th class="header-cell">% Complete</th>
                                            <th class="header-cell">$ Remaining</th>
                                            <th class="header-cell">Billed</th>
                                            <th class="header-cell">Paid</th>
                                            <th class="header-cell">Balance</th>
                                            <th class="header-cell">Retainage Held</th>
                                        </tr>
                                    </thead>
                                    <tbody class="table-body">
                                        <template for:each={paginatedFinanceData} for:item="job">
                                            <tr key={job.Id} class="data-row">
                                                <td class="data-cell center-trancate-text">
                                                    <span data-id={job.jobId}>
                                                        {job.srNo}
                                                    </span>
                                                </td>
                                                <td class="data-cell center-trancate-text">
                                                    <span class="job-name-text clickable-job-name" data-id={job.jobId}
                                                        onclick={navigateToJobRecord}>
                                                        {job.jobNumber}
                                                    </span>
                                                </td>
                                                <td class="data-cell center-trancate-text">
                                                    <span data-id={job.jobId}>
                                                        {job.jobName}
                                                    </span>
                                                </td>
                                                <td class="data-cell center-trancate-text">
                                                    <lightning-formatted-number value={job.totalContract}
                                                        format-style="currency" currency-code="USD"
                                                        maximum-fraction-digits="2">
                                                    </lightning-formatted-number>
                                                </td>
                                                <td class="data-cell center-trancate-text">
                                                    <lightning-formatted-number value={job.baseContract}
                                                        format-style="currency" currency-code="USD"
                                                        maximum-fraction-digits="2">
                                                    </lightning-formatted-number>
                                                </td>
                                                <td class="data-cell center-trancate-text">
                                                    <lightning-formatted-number value={job.changeOrder}
                                                        format-style="currency" currency-code="USD"
                                                        maximum-fraction-digits="2">
                                                    </lightning-formatted-number>
                                                </td>
                                                <td class="data-cell center-trancate-text">
                                                    <lightning-formatted-number value={job.percentComplete}
                                                        format-style="percent" maximum-fraction-digits="1">
                                                    </lightning-formatted-number>
                                                </td>
                                                <td class="data-cell center-trancate-text">
                                                    <lightning-formatted-number value={job.remainingValue}
                                                        format-style="currency" currency-code="USD"
                                                        maximum-fraction-digits="2">
                                                    </lightning-formatted-number>
                                                </td>
                                                <td class="data-cell center-trancate-text">
                                                    <lightning-formatted-number value={job.billedAmount}
                                                        format-style="currency" currency-code="USD"
                                                        maximum-fraction-digits="2">
                                                    </lightning-formatted-number>
                                                </td>
                                                <td class="data-cell center-trancate-text">
                                                    <lightning-formatted-number value={job.paidAmount}
                                                        format-style="currency" currency-code="USD"
                                                        maximum-fraction-digits="2">
                                                    </lightning-formatted-number>
                                                </td>
                                                <td class="data-cell center-trancate-text">
                                                    <lightning-formatted-number value={job.balanceAmount}
                                                        format-style="currency" currency-code="USD"
                                                        maximum-fraction-digits="2">
                                                    </lightning-formatted-number>
                                                </td>
                                                <td class="data-cell center-trancate-text">
                                                    <lightning-formatted-number value={job.retainageHeld}
                                                        format-style="currency" currency-code="USD"
                                                        maximum-fraction-digits="2">
                                                    </lightning-formatted-number>
                                                </td>
                                            </tr>
                                        </template>
                                    </tbody>
                                    <!-- Footer with Totals -->
                                    <tfoot class="table-footer">
                                        <tr class="totals-row">
                                            <td class="data-cell totals-label"></td>
                                            <td class="data-cell totals-label"></td>
                                            <td class="data-cell totals-label">Total</td>
                                            <td class="data-cell totals-label">
                                                <lightning-formatted-number value={totalContract}
                                                    format-style="currency" currency-code="USD"
                                                    maximum-fraction-digits="2">
                                                </lightning-formatted-number>
                                            </td>
                                            <td class="data-cell totals-label">
                                                <lightning-formatted-number value={totalBaseContract}
                                                    format-style="currency" currency-code="USD"
                                                    maximum-fraction-digits="2">
                                                </lightning-formatted-number>
                                            </td>
                                            <td class="data-cell totals-label">
                                                <lightning-formatted-number value={totalChangeOrder}
                                                    format-style="currency" currency-code="USD"
                                                    maximum-fraction-digits="2">
                                                </lightning-formatted-number>
                                            </td>
                                            <td class="data-cell totals-label">
                                                -
                                            </td>
                                            <td class="data-cell totals-label">
                                                <lightning-formatted-number value={totalRemaining}
                                                    format-style="currency" currency-code="USD"
                                                    maximum-fraction-digits="2">
                                                </lightning-formatted-number>
                                            </td>
                                            <td class="data-cell totals-label">
                                                <lightning-formatted-number value={totalBilled} format-style="currency"
                                                    currency-code="USD" maximum-fraction-digits="2">
                                                </lightning-formatted-number>
                                            </td>
                                            <td class="data-cell totals-label">
                                                <lightning-formatted-number value={totalPaid} format-style="currency"
                                                    currency-code="USD" maximum-fraction-digits="2">
                                                </lightning-formatted-number>
                                            </td>
                                            <td class="data-cell totals-label">
                                                <lightning-formatted-number value={totalBalance} format-style="currency"
                                                    currency-code="USD" maximum-fraction-digits="2">
                                                </lightning-formatted-number>
                                            </td>
                                            <td class="data-cell totals-label">
                                                <lightning-formatted-number value={totalRetainage}
                                                    format-style="currency" currency-code="USD"
                                                    maximum-fraction-digits="2">
                                                </lightning-formatted-number>
                                            </td>
                                        </tr>
                                    </tfoot>
                                </table>

                            </template>

                            <template if:false={isFinanceDataAvailable}>
                                <div class="no-records-message">
                                    <div class="empty-state">
                                        <div class="empty-state__content">
                                            <div class="empty-state__icon">
                                                <img src="/resource/wfrecon__emptyState" alt="" draggable="false">
                                            </div>
                                            <div class="empty-state__message">No data available to show</div>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </template>
                    </div>

                    <template if:true={isFinanceDataAvailable}>
                        <div class="pagination-section">
                            <div class="pagination-container">
                                <button class="pagination-button" onclick={handlePrevious} disabled={isFirstPage}>
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2"
                                            stroke-linecap="round" stroke-linejoin="round"></path>
                                    </svg>
                                    Previous
                                </button>

                                <template for:each={pageNumbers} for:item="page">
                                    <template if:false={page.isEllipsis}>
                                        <button key={page.number} class={page.cssClass} data-page={page.number}
                                            onclick={handlePageChange}>
                                            {page.number}
                                        </button>
                                    </template>
                                    <template if:true={page.isEllipsis}>
                                        <span key={page.number} class="pagination-ellipsis">...</span>
                                    </template>
                                </template>

                                <button class="pagination-button" onclick={handleNext} disabled={isLastPage}>
                                    Next
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2"
                                            stroke-linecap="round" stroke-linejoin="round"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </template>
                </div>
            </div>

        </div>
        <!-- Popup Modal -->
        <template if:true={showEditPopup}>
            <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open">
                <div class="slds-modal__container mob-popup">
                    <!-- Modal header -->
                    <header class="slds-modal__header mob-popup-header">
                        <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse"
                            title="Close" onclick={closeEditPopup}>
                            <lightning-icon icon-name="utility:close" alternative-text="close"
                                class="slds-button__icon slds-button__icon_large">
                            </lightning-icon>
                            <span class="slds-assistive-text">Close</span>
                        </button>
                        <h2 class="slds-text-heading_medium">Edit Status for {metricDisplayName}</h2>
                    </header>

                    <!-- Modal content -->
                    <div class="slds-modal__content mob-popup-body">
                        <div class="dual-listbox-container slds-p-horizontal_medium">
                            <lightning-dual-listbox name="statusManager" label="Manage Job Status"
                                variant="label-hidden" source-label="Available Statuses"
                                selected-label="Selected Statuses" options={statusOptions} value={editSelectedStatuses}
                                onchange={handleStatusSelection} class="custom-dual-listbox">
                            </lightning-dual-listbox>
                        </div>

                    </div>


                    <!-- Modal footer -->
                    <footer class="slds-modal__footer bottom-footer-btn">
                        <button class="slds-button slds-button_neutral confirmation-cancel-btn"
                            onclick={closeEditPopup}>Cancel</button>
                        <button class="slds-button slds-button_brand save-btn" onclick={handleSave}>Save
                            Changes</button>
                    </footer>
                </div>
            </section>
            <!-- Modal Backdrop -->
            <div class="slds-backdrop slds-backdrop_open"></div>
        </template>

    </template>

</template>